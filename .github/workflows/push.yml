# This is a basic workflow to help you get started with Actions

name: push

on:
  push:
    branches:
      - master

jobs:
  print_values:
    runs-on: ubuntu-latest
    steps:
      - name: print values
        run: |
          echo github.event: ${{ github.event }}
          echo github.event.push: ${{ github.event.pull_request }}
          echo github.event.push.next_sha: ${{ github.event.push.next_sha }}
          echo github.event.push.nextSha: ${{ github.event.push.nextSha }}
          echo github.event.push.permalink: ${{ github.event.push.permalink }}
          echo github.event.push.html_url: ${{ github.event.push.html_url }}
          echo github.event.push.url: ${{ github.event.push.url }}
          echo github.event.push.previous_sha: ${{ github.event.push.previous_sha }}
          echo github.event.push.previousSha: ${{ github.event.push.previousSha }}
          echo github.event.push.pusher: ${{ github.event.push.pusher }}
          echo github.event.push.pusher.login: ${{ github.event.push.pusher.login }}
          echo github.event.push.repository: ${{ github.event.push.repository }}
          echo github.event.push.repository.name: ${{ github.event.push.repository.name }}
          echo github.event.push.repository.nameWithOwner: ${{ github.event.push.repository.nameWithOwner }}
          echo github.event.push.repository.name_with_owner: ${{ github.event.push.repository.name_with_owner }}
          echo github.event.push.repository.owner: ${{ github.event.push.repository.owner }}
          echo -n 'node:    ' ; which node
          echo -n 'python:  ' ; which python
          echo -n 'python2: ' ; which python2
          echo -n 'python3: ' ; which python3
          echo -n 'go:      ' ; which go
          echo -n 'gcc:     ' ; which gcc
          echo -n 'perl:    ' ; which perl
          echo -n 'jq:      ' ; which jq
  notify_of_push:
    runs-on: ubuntu-latest
    steps:
      - name: prepare and send message
        run: |
          echo -n '' > msg.json
          echo -n '{"channel":"#test","text":"Someone (maybe ${{ github.event.push.pusher.login }}) pushed directly to master\n' >> msg.json
          echo -n '"}' >> msg.json
          echo '' >> msg.json
          echo ":::::::::::::::"
          cat msg.json
          echo ":::::::::::::::"
          curl -v ${{ secrets.ROCKET_CHAT_SERVER_URI }}/api/v1/chat.postMessage \
            -X POST \
            --data @msg.json \
            -H "X-Auth-Token: ${{ secrets.ROCKET_CHAT_TOKEN }}" \
            -H "X-User-Id: ${{ secrets.ROCKET_CHAT_USER_ID }}" \
            -H "Content-Type: application/json"
